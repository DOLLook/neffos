<!-- the message's input -->
<input id="input" type="text" />

<!-- when clicked then a websocket event will be sent to the server, at this example we registered the 'chat' -->
<button id="sendBtn" disabled>Send</button>

<!-- the messages will be shown here -->
<pre id="output"></pre>
<!-- import the client-side library for browser-->
<script src="/client.js"></script>

<script>
  var scheme = document.location.protocol == "https:" ? "wss" : "ws";
  var port = document.location.port ? ":" + document.location.port : "";

  var wsURL = scheme + "://" + document.location.hostname + port + "/echo";

  var input = document.getElementById("input");
  var output = document.getElementById("output");

  async function runExample() {
    let conn = await Dial(wsURL, {
      default: {
        _OnNamespaceConnected: function(ns, msg) {
          addMessage("connected to namespace: " + msg.Namespace);
        },
        _OnNamespaceDisconnect: function(ns, msg) {
          addMessage("disconnected from namespace: " + msg.Namespace);
        },
        _OnRoomJoined: function(ns, msg) {
          addMessage("joined to room: " + msg.Room);
        },
        _OnRoomLeft: function(ns, msg) {
          addMessage("left from room: " + msg.Room);
        },
        chat: function(ns, msg) {
          let prefix = "";

          if (msg.Room !== "") {
            prefix = msg.Room + " >> ";
          }
          addMessage(prefix + msg.Body);
        }
      }
    });

    try {
      let nsConn = await conn.Connect("default");
      let joinedRoom = "";
      let exampleRoomName = "room1";

      let inputTxt = document.getElementById("input");
      let sendBtn = document.getElementById("sendBtn");

      sendBtn.disabled = false;
      sendBtn.onclick = function() {
        const input = inputTxt.value;
        inputTxt.value = "";

        switch (input) {
          case "join":
            nsConn.JoinRoom(exampleRoomName);
            joinedRoom = exampleRoomName;
            break;
          case "leave":
            if (joinedRoom.length > 0) {
              nsConn.Room(exampleRoomName).Leave();
              joinedRoom = "";
            }
            break;
          default:
            if (joinedRoom.length > 0) {
              nsConn.Room(exampleRoomName).Emit("chat", input);
            } else {
              nsConn.Emit("chat", input);
            }

            addMessage("Me: " + input);
        }
      };
    } catch (err) {
      console.error(err);
    }
  }

  runExample();
  // OR:
  // Dial(wsURL, {
  //   default: {
  //     _OnNamespaceConnected: function(c, msg) {
  //       console.info("connected to ", msg.Namespace);
  //     },
  //     _OnNamespaceDisconnect: function(c, msg) {
  //       console.info("disconnected from ", msg.Namespace);
  //     },
  //     chat: function(c, msg) {
  //       console.info("on chat: " + msg.Body);
  //     }
  //   }
  // })
  //   .then(function(socket) {
  //     socket.Connect("default");
  //   })
  //   .catch(function(err) {
  //     console.error("WebSocket error observed:", err);
  //   });

  function addMessage(msg) {
    output.innerHTML += msg + "\n";
  }
</script>
